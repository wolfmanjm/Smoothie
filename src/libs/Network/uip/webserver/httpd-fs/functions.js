var concentric_circle_radii=[11,45,69,94,115];var center=[124,121];var spacer=7;var zbutton_ydistances=[7,30,55,83];var zcenter=[30,118];function runCommand(d,b){var a=$("#commandForm");d+="\n";url=b?"/command_silent":"/command";var c=$.post(url,d);if(!b){c.done(function(e){$("#result").empty();$.each(e.split("\n"),function(f){$("#result").append(this+"<br/>")})})}}function lookupConcentric(a){var b=concentric_circle_radii.length;for(i=0;i<=b;i++){if(a<concentric_circle_radii[i]){return(i)}}return(b)}function getQuadrantConcentricFromPosition(c,f){var e=c-center[0];var d=f-center[1];var b=Math.sqrt(Math.pow(Math.abs(e),2)+Math.pow(Math.abs(d),2));if(e>d&&e>-d){quadrant=0}else{if(e<=d&&e>-d){quadrant=3}else{if(e>d&&e<-d){quadrant=1}else{quadrant=2}}}var a=lookupConcentric(b);return[quadrant,a]}function clickXY(c){var a=c.offsetX?(c.offsetX):c.pageX-document.getElementById("control_xy").offsetLeft;var j=c.offsetY?(c.offsetY):c.pageY-document.getElementById("control_xy").offsetTop;var b=getQuadrantConcentricFromPosition(a,j);var d=b[0],g=b[1];if(g<5){var h=[1,0,-1,0,0,0][d];var f=[0,1,0,-1,0,0][d];var e=Math.pow(10,g-2);if(h!=0){command="G0 X"+(e*h)+" F"+document.getElementById("xy_velocity").value}else{command="G0 Y"+(e*f)+" F"+document.getElementById("xy_velocity").value}runCommand("G91 "+command+" G90",true)}else{if(a<49&&j<49){command="G28 X0"}else{if(a>200&&j<49){command="G28 Y0"}else{if(a<49&&j>200){command="G28"}else{command="G28 Z0"}}}runCommand(command,true)}}function lookupRange(b){var a=zbutton_ydistances.length;for(i=0;i<a;i++){if(b<zbutton_ydistances[i]){return i}}}function clickZ(d){var c=d.offsetY?(d.offsetY):d.pageY-document.getElementById("control_z").offsetTop;var a=zcenter[1]-c;var b=lookupRange(Math.abs(a));var e=(a>0)?1:-1;if(b<4){runCommand("G91 G0 Z"+(Math.pow(10,b-2)*e)+" F"+document.getElementById("z_velocity").value+" G90",true)}}function extrude(g,d,c){var f=document.getElementById("extrude_length").value;var e=document.getElementById("extrude_velocity").value;var h=(g.currentTarget.id=="extrude")?1:-1;runCommand("G91 G0 E"+(f*h)+" F"+e+" G90",true)}function motorsOff(a){runCommand("M18",true)}function heatSet(c){var b=(c.currentTarget.id=="heat_set")?104:140;var a=(b==104)?document.getElementById("heat_value").value:document.getElementById("bed_value").value;runCommand("M"+b+" S"+a,true)}function heatOff(b){var a=(b.currentTarget.id=="heat_off")?104:140;runCommand("M"+a+" S0",true)}function getTemperature(){runCommand("M105",false)}function handleFileSelect(a){var d=a.target.files;var b=[];for(var c=0,e;e=d[c];c++){b.push("<li><strong>",escape(e.name),"</strong> (",e.type||"n/a",") - ",e.size," bytes, last modified: ",e.lastModifiedDate?e.lastModifiedDate.toLocaleDateString():"n/a","</li>")}document.getElementById("list").innerHTML="<ul>"+b.join("")+"</ul>"}function upload(){$("#progress").empty();$("#uploadresult").empty();var b=document.getElementById("files").files[0];var a=new FileReader();a.readAsBinaryString(b);a.onloadend=function(c){xhr=new XMLHttpRequest();xhr.open("POST","upload",true);xhr.setRequestHeader("X-Filename",b.name);XMLHttpRequest.prototype.mySendAsBinary=function(k){var h=new ArrayBuffer(k.length);var f=new Uint8Array(h,0);for(var g=0;g<k.length;g++){f[g]=(k.charCodeAt(g)&255)}if(typeof window.Blob=="function"){var e=new Blob([h])}else{var j=new (window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder)();j.append(h);var e=j.getBlob()}this.send(e)};var d=xhr.upload||xhr;d.addEventListener("progress",function(j){var f=j.position||j.loaded;var h=j.totalSize||j.total;var g=Math.round((f/h)*100);$("#progress").empty().append("uploaded "+g+"%")});xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){$("#uploadresult").empty().append("Uploaded Ok")}else{$("#uploadresult").empty().append("Uploaded Failed")}}};xhr.mySendAsBinary(c.target.result)}};